# 2025-12-03 - Health mode evolvable interaction values

## Dependencies and setup

```{r}
library(tidyverse)
library(cowplot)
library(RColorBrewer)
library(khroma)
library(rstatix)
library(knitr)
library(kableExtra)
library(viridis)
# library(webshot2)
```

```{r}
# Build relative path from R's working directory to what is actually the working
# directory for this experiment.
experiment_slug <- "2025-12-03-health-evo-intval"
working_directory <- paste(
  "experiments",
  experiment_slug,
  "analysis",
  sep = "/"
)
```

```{r}
# Use the cowplot theme as our default for ggplots
theme_set(theme_cowplot())
# Create directory to save plots
plot_dir <- paste(
  working_directory,
  "plots",
  sep = "/"
)
dir.create(
  plot_dir,
  showWarnings = FALSE
)
```

### Load and preprocess data

```{r}
tasks <- c("NOT", "NAND", "OR_NOT", "AND", "OR", "AND_NOT", "NOR", "XOR", "EQU")
max_pop_size <- 100 * 100
threshold <- 0.025 * max_pop_size
```

Load summary data.

```{r}
summary_data_path <- paste(
  working_directory,
  "data",
  "summary.csv",
  sep = "/"
)
summary_data <- read_csv(summary_data_path)
# Do any universal preprocessing
summary_data <- summary_data %>%
  mutate(
    SEED = as.factor(SEED),
    START_MOI = as.factor(START_MOI),
    VERTICAL_TRANSMISSION = as.factor(VERTICAL_TRANSMISSION),
    MUTUALIST_CYCLE_DONATE_MULTIPLIER = as.factor(MUTUALIST_CYCLE_DONATE_MULTIPLIER), # nolint: line_length_linter.
    PARASITE_CYCLE_STEAL_MULTIPLIER = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER), # nolint: line_length_linter.
    HEALTH_TYPE = as.factor(HEALTH_TYPE),
    PARASITE_CYCLE_LOSS_PROP = as.factor(PARASITE_CYCLE_LOSS_PROP),
    HEALTH_INTERACTION_CHANCE = as.factor(HEALTH_INTERACTION_CHANCE),
    PARASITE_BASE_CYCLE_PROP = as.factor(PARASITE_BASE_CYCLE_PROP)
  ) %>%
  mutate(
    treatment = paste0(
      "VT=", VERTICAL_TRANSMISSION,
      "_IM=", PARASITE_CYCLE_STEAL_MULTIPLIER
    ),
    interaction_multiplier = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER)
  ) %>%
  mutate(
    treatment = as.factor(
      treatment
    )
  )
```

Load time series data.

```{r}
time_data_path <- paste(
  working_directory,
  "data",
  "time_series.csv",
  sep = "/"
)
time_data <- read_csv(time_data_path)

# Do any universal preprocessing
time_data <- time_data %>%
  mutate(
    SEED = as.factor(SEED),
    VERTICAL_TRANSMISSION = as.factor(VERTICAL_TRANSMISSION),
    MUTUALIST_CYCLE_DONATE_MULTIPLIER = as.factor(MUTUALIST_CYCLE_DONATE_MULTIPLIER), # nolint: line_length_linter.
    PARASITE_CYCLE_STEAL_MULTIPLIER = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER), # nolint: line_length_linter.
  ) %>%
  mutate(
    treatment = paste0(
      "VT=", VERTICAL_TRANSMISSION,
      "_IM=", PARASITE_CYCLE_STEAL_MULTIPLIER
    ),
    interaction_multiplier = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER)
  ) %>%
  mutate(
    treatment = as.factor(
      treatment
    )
  )
```


## Which runs had hosts and/or symbiont populations that went extinct?

```{r}
sym_min_pop_sizes <- time_data %>%
  group_by(SEED) %>%
  slice_min(
    OrgCounts_hosted_sym_count,
    n = 1
  ) %>%
  slice_min(
    update,
    n = 1
  )

reps_with_extinct_syms <- sym_min_pop_sizes %>%
  group_by(
    treatment
  ) %>%
  summarize(
    reps_with_extinct_syms = sum(OrgCounts_hosted_sym_count == 0)
  )

host_min_pop_sizes <- time_data %>%
  group_by(SEED) %>%
  slice_min(
    OrgCounts_host_count,
    n = 1
  ) %>%
  slice_min(
    update,
    n = 1
  )

reps_with_extinct_hosts <- host_min_pop_sizes %>%
  group_by(
    treatment
  ) %>%
  summarize(
    reps_with_extinct_hosts = sum(OrgCounts_host_count == 0)
  )

extinctions <- full_join(
  reps_with_extinct_syms,
  reps_with_extinct_hosts
)
extinctions <- extinctions %>%
  arrange(
    desc(reps_with_extinct_hosts), desc(reps_with_extinct_syms)
  )
extinction_table <- kable(extinctions) %>%
  kable_styling(latex_options = "striped")
save_kable(
  extinction_table,
  paste(
    plot_dir,
    "extinctions.pdf",
    sep = "/"
  )
)
```

## Final task performance

### Using tasks completed by parents - Hosts

```{r}
# Pivot task data long:
# 1) Select only relevant columns
host_final_parent_task_data <- summary_data %>%
  select(
    SEED,
    treatment,
    CurUpdate_AND_NOT_in_host_parent_org_counts,
    CurUpdate_AND_in_host_parent_org_counts,
    CurUpdate_EQU_in_host_parent_org_counts,
    CurUpdate_NAND_in_host_parent_org_counts,
    CurUpdate_NOR_in_host_parent_org_counts,
    CurUpdate_NOT_in_host_parent_org_counts,
    CurUpdate_OR_NOT_in_host_parent_org_counts,
    CurUpdate_OR_in_host_parent_org_counts,
    CurUpdate_XOR_in_host_parent_org_counts
  ) %>%
  pivot_longer(
    c(
      CurUpdate_AND_NOT_in_host_parent_org_counts,
      CurUpdate_AND_in_host_parent_org_counts,
      CurUpdate_EQU_in_host_parent_org_counts,
      CurUpdate_NAND_in_host_parent_org_counts,
      CurUpdate_NOR_in_host_parent_org_counts,
      CurUpdate_NOT_in_host_parent_org_counts,
      CurUpdate_OR_NOT_in_host_parent_org_counts,
      CurUpdate_OR_in_host_parent_org_counts,
      CurUpdate_XOR_in_host_parent_org_counts
    ),
    names_to = "task",
    values_to = "task_in_parent_count"
  ) %>%
  mutate(
    task = str_replace(task, "CurUpdate_", "")
  ) %>%
  mutate(
    task = str_replace(task, "_in_host_parent_org_counts", "")
  ) %>%
  mutate(
    task_completed_by_parent = task_in_parent_count >= threshold,
    task = factor(
      task,
      levels = tasks,
      labels = tasks
    )
  )

host_final_parent_task_done <- host_final_parent_task_data %>%
  group_by(
    treatment,
    task
  ) %>%
  summarize(
    total_reps = n(),
    tasks_completed_by_parent = sum(task_completed_by_parent == TRUE)
  )
```

```{r}
host_final_parent_task_done_plt <- host_final_parent_task_done %>%
  ggplot(
    aes(
      x = treatment,
      color = treatment,
      fill = treatment,
      y = tasks_completed_by_parent
    )
  ) +
  geom_col(alpha = 0.5) +
  scale_x_discrete() +
  facet_wrap(~task) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 45,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "host_final_parent_task_done_plt.pdf", sep = "/"),
  plot = host_final_parent_task_done_plt,
  width = 30,
  height = 20
)
```

## Task performance all time

### Hosts

Quantify whether tasks have been performed over course of entire run.

```{r}
# Pivot task data long:
# 1) Select only relevant columns
host_over_time_parent_task_data <- time_data %>%
  select(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
    update,
    CurUpdate_AND_NOT_in_host_parent_org_counts,
    CurUpdate_AND_in_host_parent_org_counts,
    CurUpdate_EQU_in_host_parent_org_counts,
    CurUpdate_NAND_in_host_parent_org_counts,
    CurUpdate_NOR_in_host_parent_org_counts,
    CurUpdate_NOT_in_host_parent_org_counts,
    CurUpdate_OR_NOT_in_host_parent_org_counts,
    CurUpdate_OR_in_host_parent_org_counts,
    CurUpdate_XOR_in_host_parent_org_counts
  ) %>%
  pivot_longer(
    c(
      CurUpdate_AND_NOT_in_host_parent_org_counts,
      CurUpdate_AND_in_host_parent_org_counts,
      CurUpdate_EQU_in_host_parent_org_counts,
      CurUpdate_NAND_in_host_parent_org_counts,
      CurUpdate_NOR_in_host_parent_org_counts,
      CurUpdate_NOT_in_host_parent_org_counts,
      CurUpdate_OR_NOT_in_host_parent_org_counts,
      CurUpdate_OR_in_host_parent_org_counts,
      CurUpdate_XOR_in_host_parent_org_counts
    ),
    names_to = "task",
    values_to = "task_in_parent_count"
  ) %>%
  mutate(
    task = str_replace(task, "CurUpdate_", "")
  ) %>%
  mutate(
    task = str_replace(task, "_in_host_parent_org_counts", "")
  ) %>%
  mutate(
    task_completed_by_parent = task_in_parent_count >= threshold,
    task = factor(
      task,
      levels = tasks,
      labels = tasks
    )
  )

host_parent_tasks_all_time_by_task <- host_over_time_parent_task_data %>%
  # filter(update <= 100000) %>%
  group_by(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    interaction_multiplier,
    task
  ) %>%
  summarize(
    n = n(),
    parent_task_completed_ever = any(task_completed_by_parent)
  ) %>%
  ungroup() %>%
  group_by(
    treatment,
    VERTICAL_TRANSMISSION,
    interaction_multiplier,
    task
  ) %>%
  summarize(
    n = n(),
    parent_tasks_completed_ever = sum(parent_task_completed_ever == TRUE)
  )

# parent_tasks_all_time_total <- parent_tasks_all_time_by_task %>%

```

```{r}
host_parent_tasks_all_time_by_task <- host_parent_tasks_all_time_by_task %>%
  mutate(
    VT = VERTICAL_TRANSMISSION,
    MULT = interaction_multiplier
  )
host_parent_tasks_all_time_by_task_plt <- host_parent_tasks_all_time_by_task %>%
  ggplot(
    aes(
      x = task,
      color = task,
      fill = task,
      y = parent_tasks_completed_ever
    )
  ) +
  geom_col(
    position = "dodge",
    alpha = 0.5
  ) +
  geom_text(
    aes(label = parent_tasks_completed_ever),
    position = position_dodge(width = 1),
    vjust = -0.5,
    size = 2
  ) +
  scale_x_discrete() +
  facet_grid(MULT ~ VT, labeller = label_both) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 90,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "host_parent_tasks_all_time_by_task_plt.pdf", sep = "/"),
  plot = host_parent_tasks_all_time_by_task_plt,
  width = 20,
  height = 20
)
```

Average number of different tasks evolved?

```{r}
host_avg_tasks_table <- host_total_different_parent_tasks_all_time %>%
  group_by(treatment) %>%
  summarize(avg_diff_num_host_parent_tasks = mean(num_parent_tasks_completed_ever)) %>%
  arrange(desc(avg_diff_num_host_parent_tasks)) %>%
  kable() %>%
  kable_styling(latex_options = "striped")
save_kable(
  host_avg_tasks_table,
  paste(
    plot_dir,
    "host_avg_diff_num_host_parent_tasks.pdf",
    sep = "/"
  )
)
```

### Symbionts

Quantify whether tasks have been performed over course of entire run.

```{r}
# Pivot task data long:
# 1) Select only relevant columns
over_time_sym_parent_task_data <- time_data %>%
  select(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
    update,
    CurUpdate_AND_NOT_in_sym_parent_org_counts,
    CurUpdate_AND_in_sym_parent_org_counts,
    CurUpdate_EQU_in_sym_parent_org_counts,
    CurUpdate_NAND_in_sym_parent_org_counts,
    CurUpdate_NOR_in_sym_parent_org_counts,
    CurUpdate_NOT_in_sym_parent_org_counts,
    CurUpdate_OR_NOT_in_sym_parent_org_counts,
    CurUpdate_OR_in_sym_parent_org_counts,
    CurUpdate_XOR_in_sym_parent_org_counts
  ) %>%
  pivot_longer(
    c(
      CurUpdate_AND_NOT_in_sym_parent_org_counts,
      CurUpdate_AND_in_sym_parent_org_counts,
      CurUpdate_EQU_in_sym_parent_org_counts,
      CurUpdate_NAND_in_sym_parent_org_counts,
      CurUpdate_NOR_in_sym_parent_org_counts,
      CurUpdate_NOT_in_sym_parent_org_counts,
      CurUpdate_OR_NOT_in_sym_parent_org_counts,
      CurUpdate_OR_in_sym_parent_org_counts,
      CurUpdate_XOR_in_sym_parent_org_counts
    ),
    names_to = "task",
    values_to = "task_in_parent_count"
  ) %>%
  mutate(
    task = str_replace(task, "CurUpdate_", "")
  ) %>%
  mutate(
    task = str_replace(task, "_in_sym_parent_org_counts", "")
  ) %>%
  mutate(
    task_completed_by_parent = task_in_parent_count >= threshold,
    task = factor(
      task,
      levels = tasks,
      labels = tasks
    )
  )

sym_parent_tasks_all_time_by_task <- over_time_sym_parent_task_data %>%
  group_by(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
    task
  ) %>%
  summarize(
    n = n(),
    parent_task_completed_ever = any(task_completed_by_parent)
  ) %>%
  ungroup() %>%
  group_by(
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
    task
  ) %>%
  summarize(
    n = n(),
    parent_tasks_completed_ever = sum(parent_task_completed_ever == TRUE)
  )

# parent_tasks_all_time_total <- parent_tasks_all_time_by_task %>%

```

```{r}
sym_parent_tasks_all_time_by_task <- sym_parent_tasks_all_time_by_task %>%
  mutate(
    VT = VERTICAL_TRANSMISSION,
    MULT = interaction_multiplier
  )
sym_parent_tasks_all_time_by_task_plt <- sym_parent_tasks_all_time_by_task %>%
  ggplot(
    aes(
      x = task,
      color = task,
      fill = task,
      y = parent_tasks_completed_ever
    )
  ) +
  geom_col(
    position = "dodge",
    alpha = 0.5
  ) +
  geom_text(
    aes(label = parent_tasks_completed_ever),
    position = position_dodge(width = 1),
    vjust = -0.5,
    size = 2
  ) +
  scale_x_discrete() +
  facet_grid(MULT ~ VT, labeller = label_both) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 90,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "sym_parent_tasks_all_time_by_task_plt.pdf", sep = "/"),
  plot = sym_parent_tasks_all_time_by_task_plt,
  width = 20,
  height = 20
)
```

Total different tasks (all time)

```{r}
total_different_sym_parent_tasks_all_time <- over_time_sym_parent_task_data %>%
  group_by(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
    task
  ) %>%
  # Summarize across updates whether task was ever completed by a parent.
  summarize(
    n = n(),
    parent_task_completed_ever = any(task_completed_by_parent)
  ) %>%
  ungroup() %>%
  group_by(
    SEED,
    treatment,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    interaction_multiplier,
  ) %>%
  # Summarize across tasks (by seed)
  summarize(
    n = n(),
    num_parent_tasks_completed_ever = sum(parent_task_completed_ever == TRUE)
  )
```

Average number of different tasks evolved?

```{r}
sym_avg_tasks_table <- total_different_sym_parent_tasks_all_time %>%
  group_by(treatment) %>%
  summarize(avg_diff_num_sym_parent_tasks = mean(num_parent_tasks_completed_ever)) %>%
  arrange(desc(avg_diff_num_sym_parent_tasks)) %>%
  kable() %>%
  kable_styling(latex_options = "striped")
save_kable(
  sym_avg_tasks_table,
  paste(
    plot_dir,
    "sym_avg_diff_num_parent_tasks.pdf",
    sep = "/"
  )
)
```

## Population size

Average / median population size

```{r}
pop_size_summary <- time_data %>%
  group_by(
    SEED,
    treatment
  ) %>%
  summarize(
    host_pop_size_avg = mean(OrgCounts_host_count),
    host_pop_size_median = median(OrgCounts_host_count),
    host_pop_size_variance = var(OrgCounts_host_count),
    sym_pop_size_avg = mean(OrgCounts_hosted_sym_count),
    sym_pop_size_median = median(OrgCounts_hosted_sym_count),
    sym_pop_size_variance = var(OrgCounts_hosted_sym_count)
  )
```

```{r}
host_pop_size_avg_plt <- pop_size_summary %>%
  ggplot(
    aes(x = treatment, fill = treatment, y = host_pop_size_avg)
  ) +
  geom_point(
    mapping=aes(color = treatment),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_x_discrete() +
  # facet_wrap(STRESS_FREQUENCY~stress_death_chance, labeller = label_both) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 60,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "host_pop_size_avg_plt.pdf", sep = "/"),
  plot = host_pop_size_avg_plt,
  width = 10,
  height = 10
)
```

```{r}
host_pop_size_variance_plt <- pop_size_summary %>%
  ggplot(
    aes(x = treatment, fill = treatment, y = host_pop_size_variance)
  ) +
  geom_point(
    mapping=aes(color = treatment),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_x_discrete() +
  # facet_wrap(STRESS_FREQUENCY~stress_death_chance, labeller = label_both) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 60,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "host_pop_size_variance_plt.pdf", sep = "/"),
  plot = host_pop_size_variance_plt,
  width = 10,
  height = 10
)
```

## Symbiont interaction values

Load symbiont interaction values

```{r}
sym_int_vals_path <-  paste(
  working_directory,
  "data",
  "symbiont_interaction_values.csv",
  sep = "/"
)
sym_int_vals_data <- read_csv(sym_int_vals_path)

sym_int_vals_data <- sym_int_vals_data %>%
  mutate(
    SEED = as.factor(SEED),
    START_MOI = as.factor(START_MOI),
    VERTICAL_TRANSMISSION = as.factor(VERTICAL_TRANSMISSION),
    MUTUALIST_CYCLE_DONATE_MULTIPLIER = as.factor(MUTUALIST_CYCLE_DONATE_MULTIPLIER), # nolint: line_length_linter.
    PARASITE_CYCLE_STEAL_MULTIPLIER = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER), # nolint: line_length_linter.
    HEALTH_TYPE = as.factor(HEALTH_TYPE),
    PARASITE_CYCLE_LOSS_PROP = as.factor(PARASITE_CYCLE_LOSS_PROP),
    HEALTH_INTERACTION_CHANCE = as.factor(HEALTH_INTERACTION_CHANCE),
    PARASITE_BASE_CYCLE_PROP = as.factor(PARASITE_BASE_CYCLE_PROP)
  ) %>%
  mutate(
    treatment = paste0(
      "VT=", VERTICAL_TRANSMISSION,
      "_IM=", PARASITE_CYCLE_STEAL_MULTIPLIER
    ),
    interaction_multiplier = as.factor(PARASITE_CYCLE_STEAL_MULTIPLIER)
  ) %>%
  mutate(
    treatment = as.factor(
      treatment
    ),
    # Note: could come back to this to adjust how we do sorting
    super_mutualist_prop = (Hist_0.8 + Hist_0.9) / count
  )

# Give each seed a rep_id based on its super mutualist prop
sym_int_vals_data <- sym_int_vals_data %>%
  group_by(
    treatment
  ) %>%
  arrange(
    super_mutualist_prop
  ) %>%
  mutate(
    rep_id = rep(1:50, 1)
  ) %>%
  ungroup()

```

Pivot on histogram columns to long format

```{r}
long_sym_int_vals_data <- sym_int_vals_data %>%
  select(
    SEED,
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    treatment,
    interaction_multiplier,
    count,
    rep_id,
    super_mutualist_prop,
    "Hist_-0.1",
    "Hist_-0.2",
    "Hist_-0.3",
    "Hist_-0.4",
    "Hist_-0.5",
    "Hist_-0.6",
    "Hist_-0.7",
    "Hist_-0.8",
    "Hist_-0.9",
    "Hist_-1",
    "Hist_0.0",
    "Hist_0.1",
    "Hist_0.2",
    "Hist_0.3",
    "Hist_0.4",
    "Hist_0.5",
    "Hist_0.6",
    "Hist_0.7",
    "Hist_0.8",
    "Hist_0.9"
  ) %>%
  rename(total_syms = count) %>%
  pivot_longer(
    cols = -c(
      SEED,
      VERTICAL_TRANSMISSION,
      MUTUALIST_CYCLE_DONATE_MULTIPLIER,
      PARASITE_CYCLE_STEAL_MULTIPLIER,
      treatment,
      interaction_multiplier,
      total_syms,
      super_mutualist_prop,
      rep_id
    ),
    names_to = "int_val_range",
    values_to = "int_val_count"
  ) %>%
  mutate(
    int_val_range = as.factor(int_val_range)
  )
```

Summarize interaction value ranges:
- Collapse bins to fewer categories, matching with ALife 2025
  tag paper bins.

```{r}
long_sym_int_vals_data <- long_sym_int_vals_data %>%
  # Recategorize
  mutate(
    int_val_range_reduced = case_when(
      int_val_range == "Hist_-1" ~ "-1.0 to -0.8 (Parasitic)",
      int_val_range == "Hist_-0.9" ~ "-1.0 to -0.8 (Parasitic)",
      int_val_range == "Hist_-0.8" ~ "-0.8 to -0.6 (Parasitic)",
      int_val_range == "Hist_-0.7" ~ "-0.8 to -0.6 (Parasitic)",
      int_val_range == "Hist_-0.6" ~ "-0.6 to -0.4 (Detrimental)",
      int_val_range == "Hist_-0.5" ~ "-0.6 to -0.4 (Detrimental)",
      int_val_range == "Hist_-0.4" ~ "-0.4 to -0.2 (Detrimental)",
      int_val_range == "Hist_-0.3" ~ "-0.4 to -0.2 (Detrimental)",
      int_val_range == "Hist_-0.2" ~ "-0.2 to 0 (Nearly neutral)",
      int_val_range == "Hist_-0.1" ~ "-0.2 to 0 (Nearly neutral)",
      int_val_range == "Hist_0.0" ~ "0 to 0.2 (Nearly neutral)",
      int_val_range == "Hist_0.1" ~ "0 to 0.2 (Nearly neutral)",
      int_val_range == "Hist_0.2" ~ "0.2 to 0.4 (Positive)",
      int_val_range == "Hist_0.3" ~ "0.2 to 0.4 (Positive)",
      int_val_range == "Hist_0.4" ~ "0.4 to 0.6 (Positive)",
      int_val_range == "Hist_0.5" ~ "0.4 to 0.6 (Positive)",
      int_val_range == "Hist_0.6" ~ "0.6 to 0.8 (Mutualistic)",
      int_val_range == "Hist_0.7" ~ "0.6 to 0.8 (Mutualistic)",
      int_val_range == "Hist_0.8" ~ "0.8 to 1.0 (Mutualistic)",
      int_val_range == "Hist_0.9" ~ "0.8 to 1.0 (Mutualistic)",
      .default = "unknown"
    )
  ) %>%
  mutate(
    int_val_range_reduced = factor(
      int_val_range_reduced,
      levels = c(
        "-1.0 to -0.8 (Parasitic)",
        "-0.8 to -0.6 (Parasitic)",
        "-0.6 to -0.4 (Detrimental)",
        "-0.4 to -0.2 (Detrimental)",
        "-0.2 to 0 (Nearly neutral)",
        "0 to 0.2 (Nearly neutral)",
        "0.2 to 0.4 (Positive)",
        "0.4 to 0.6 (Positive)",
        "0.6 to 0.8 (Mutualistic)",
        "0.8 to 1.0 (Mutualistic)"
      )
    )
  ) %>%
  # Collapse
  group_by(
    SEED,
    total_syms, # Note: total syms will be same for all rows of same seed.
    VERTICAL_TRANSMISSION,
    MUTUALIST_CYCLE_DONATE_MULTIPLIER,
    PARASITE_CYCLE_STEAL_MULTIPLIER,
    treatment,
    interaction_multiplier,
    int_val_range_reduced,
    rep_id
  ) %>%
  summarize(
    int_val_count = sum(int_val_count)
  ) %>%
  mutate(
    int_val_prop = int_val_count / total_syms,
    VT = VERTICAL_TRANSMISSION,
    INT_MULT = interaction_multiplier
  )

# Order by "proportion of ubermutualists"
# test <- long_sym_int_vals_data %>%
#   group_by(
#     SEED
#   )

```

```{r}
tenhelix <- c(
  "#891901",
  "#B50142",
  "#D506AD",
  "#AB08FF",
  "#5731FD",
  "#4755FF",
  "#42bcf5",
  "#42e0f5",
  "#9af1fc",
  "#c5f6fc"
)
sym_int_val_props_plt <- long_sym_int_vals_data %>%
  ggplot(
    mapping = aes(
      fill = int_val_range_reduced,
      x = rep_id,
      y = int_val_count,
      na.rm = TRUE
    )
  ) +
  geom_col(
    position = "fill",
    na.rm = TRUE,
    width = 1
  ) +
  scale_fill_manual(
    name = "Behavior",
    values = tenhelix
  ) +
  labs(
    x = "Replicate",
    y = "Proportion of symbiont population"
  ) +
  facet_grid(
    INT_MULT ~ VT,
    labeller = label_both
  ) +
  guides(
    fill = guide_legend(nrow = 2, byrow = TRUE)
  ) +
  theme(
    legend.position = "bottom"
  )

ggsave(
  file = paste(plot_dir, "sym_interaction_value_counts.pdf", sep = "/"),
  plot = sym_int_val_props_plt,
  width = 30,
  height = 20
)
```

```{r}
temp <- sym_int_vals_data %>%
  arrange(mean_intval)
```

## Phenotypic diversity

### Host diversity

#### Host number of task sets

```{r}
host_parent_num_task_sets_plt <- time_data %>%
  filter(update %% 500 == 0) %>%
  ggplot(
    aes(
      x = update,
      y = CurUpdate_host_parent_num_task_sets,
      color = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION
    )
  ) +
  stat_summary(fun = "mean", geom = "line") +
  stat_summary(
    fun.data = "mean_cl_boot",
    fun.args = list(conf.int = 0.95),
    geom = "ribbon",
    alpha = 0.2,
    linetype = 0
  ) +
  facet_wrap(
    ~interaction_multiplier,
    axes = "all_x",
    labeller = label_both
  ) +
  theme(
    legend.position = "bottom"
  )
ggsave(
  file = paste(plot_dir, "host_parent_num_task_sets_plt.pdf", sep = "/"),
  plot = host_parent_num_task_sets_plt,
  width = 15,
  height = 15
)
```

#### Host entropy of task sets

```{r}
host_parent_entropy_task_sets_plt <- time_data %>%
  filter(update %% 500 == 0) %>%
  ggplot(
    aes(
      x = update,
      y = CurUpdate_host_parent_entropy_task_sets,
      color = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION
    )
  ) +
  stat_summary(fun = "mean", geom = "line") +
  stat_summary(
    fun.data = "mean_cl_boot",
    fun.args = list(conf.int = 0.95),
    geom = "ribbon",
    alpha = 0.2,
    linetype = 0
  ) +
  facet_wrap(
    ~interaction_multiplier,
    axes = "all_x",
    labeller = label_both
  ) +
  theme(
    legend.position = "bottom"
  )
ggsave(
  file = paste(plot_dir, "host_parent_entropy_task_sets_plt.pdf", sep = "/"),
  plot = host_parent_entropy_task_sets_plt,
  width = 15,
  height = 15
)
```

### Symbiont diversity

#### Symbiont number of task sets

```{r}
symbiont_parent_num_task_sets_plt <- time_data %>%
  filter(update %% 500 == 0) %>%
  ggplot(
    aes(
      x = update,
      y = CurUpdate_sym_parent_num_task_sets,
      color = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION
    )
  ) +
  stat_summary(fun = "mean", geom = "line") +
  stat_summary(
    fun.data = "mean_cl_boot",
    fun.args = list(conf.int = 0.95),
    geom = "ribbon",
    alpha = 0.2,
    linetype = 0
  ) +
  facet_wrap(
    ~interaction_multiplier,
    axes = "all_x",
    labeller = label_both
  ) +
  theme(
    legend.position = "bottom"
  )
ggsave(
  file = paste(plot_dir, "symbiont_parent_num_task_sets_plt.pdf", sep = "/"),
  plot = symbiont_parent_num_task_sets_plt,
  width = 15,
  height = 15
)
```

#### Symbiont entropy of task sets

```{r}
symbiont_parent_entropy_task_sets_plt <- time_data %>%
  filter(update %% 500 == 0) %>%
  ggplot(
    aes(
      x = update,
      y = CurUpdate_sym_parent_entropy_task_sets,
      color = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION
    )
  ) +
  stat_summary(fun = "mean", geom = "line") +
  stat_summary(
    fun.data = "mean_cl_boot",
    fun.args = list(conf.int = 0.95),
    geom = "ribbon",
    alpha = 0.2,
    linetype = 0
  ) +
  facet_wrap(
    ~interaction_multiplier,
    axes = "all_x",
    labeller = label_both
  ) +
  theme(
    legend.position = "bottom"
  )
ggsave(
  file = paste(plot_dir, "symbiont_parent_entropy_task_sets_plt.pdf", sep = "/"),
  plot = symbiont_parent_entropy_task_sets_plt,
  width = 15,
  height = 15
)
```

## Generations elapsed

### Hosts

```{r}
host_avg_gens_elapsed_plt <- summary_data %>%
  ggplot(
    aes(
      x = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION,
      y = CurUpdate_host_mean_generations
    )
  ) +
  geom_point(
    mapping = aes(color = VERTICAL_TRANSMISSION),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  facet_wrap(~interaction_multiplier) +
  scale_x_discrete() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 60,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "host_avg_gens_elapsed_plt.pdf", sep = "/"),
  plot = host_avg_gens_elapsed_plt,
  width = 10,
  height = 10
)
```

### Symbionts

```{r}
sym_avg_gens_elapsed_plt <- summary_data %>%
  ggplot(
    aes(
      x = VERTICAL_TRANSMISSION,
      fill = VERTICAL_TRANSMISSION,
      y = CurUpdate_sym_mean_generations
    )
  ) +
  geom_point(
    mapping=aes(color = VERTICAL_TRANSMISSION),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_x_discrete() +
  facet_wrap(~interaction_multiplier) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(
      angle = 60,
      hjust = 1
    )
  )
ggsave(
  file = paste(plot_dir, "sym_avg_gens_elapsed_plt.pdf", sep = "/"),
  plot = sym_avg_gens_elapsed_plt,
  width = 10,
  height = 10
)
```
